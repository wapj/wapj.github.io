{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/import-c-library-in-python/","result":{"data":{"markdownRemark":{"html":"<h2><code class=\"language-text\">_mysql</code> 이 없다는 에러 발생</h2>\n<p>장고에서 mysqlclient를 사용하고 있는데, 쓰다보면 아래와 같은 에러를 만나는 경우가 종종있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ImportError: dlopen(..._mysql.cpython-38-darwin.so, 2): Library not loaded: @rpath/libmysqlclient.21.dylib\n  Referenced from: .../site-packages/_mysql.cpython-38-darwin.so\n  Reason: image not found\nNameError: name &#39;_mysql&#39; is not defined</code></pre></div>\n<p>에러를 보면 <code class=\"language-text\">_mysql</code> 이 정의되지 않았다고 한다.\n또 그 녀석은 cpython-38-darwin.so 이라는 파일에 있는 것 같다. 그렇다는 얘기는 <code class=\"language-text\">cpython-38-darwin.so</code> 이 잘못되었다는 것 같은데, 사실 파이썬만 보면 저 파일이 잘못됐는지 아닌지 알 수가 없다.</p>\n<p>문제를 좀 더 쉽게 재현해 보자.</p>\n<h2>문제 재현</h2>\n<p>문제를 재현하는것은 의외로 쉬운데 <code class=\"language-text\">MySQLdb</code> 모듈을 임포트 해보면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">python -c &quot;import MySQLdb&quot;</code></pre></div>\n<p>그러면 아래와 같이 _mysql 이 없다고 에러가 난다. ImportError 쪽을 보면 Library not loaded: @rpath/libmysqlclient.21.dylib 라고 위에 나왔던 에러가 그대로 나오게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Traceback (most recent call last):\n  File &quot;/Users/gyus/.pyenv/versions/py38/lib/python3.8/site-packages/MySQLdb/__init__.py&quot;, line 18, in &lt;module&gt;\n    from . import _mysql\nImportError: dlopen(/Users/gyus/.pyenv/versions/py38/lib/python3.8/site-packages/MySQLdb/_mysql.cpython-38-darwin.so, 2):\nLibrary not loaded: @rpath/libmysqlclient.21.dylib\n  Referenced from: /Users/gyus/.pyenv/versions/py38/lib/python3.8/site-packages/MySQLdb/_mysql.cpython-38-darwin.so\n  Reason: image not found\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;\n  File &quot;/Users/gyus/.pyenv/versions/py38/lib/python3.8/site-packages/MySQLdb/__init__.py&quot;, line 24, in &lt;module&gt;\n    version_info, _mysql.version_info, _mysql.__file__\nNameError: name &#39;_mysql&#39; is not defined</code></pre></div>\n<h2>원인</h2>\n<p>brew 로 mysql-client 를 설치한 경우 <code class=\"language-text\">/usr/local/mysql/bin/mysql/lib</code>의 경로에 <code class=\"language-text\">cpython-38-darwin.so</code> 파일이 위치해 있는데, 파이썬에서 찾지 못해서 에러가 난다. 간단하게는 심볼릭 링크를 만들어주면 해결이 된다.</p>\n<h2>해결하기</h2>\n<p>아래 두가지중에 한 가지를 해주면 된다.</p>\n<ol>\n<li>심볼릭 링크를 만들어 주자.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /usr/local/mysql/lib/libmysqlclient.21.dylib /usr/local/lib/libmysqlclient.21.dylib</code></pre></div>\n<ol start=\"2\">\n<li>DYDL 라이브러리 패스에 <code class=\"language-text\">/usr/local/mysql/lib/</code> 를 추가해존다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DYLD_LIBRARY_PATH</span><span class=\"token operator\">=</span>/usr/local/mysql/lib/:<span class=\"token variable\">$DYLD_LIBRARY_PATH</span></code></pre></div>\n<p>둘다 C의 동적라이브러리 패스를 파이썬이 알 수 있도록 잡아주는 것이다. 원인은 별거가 아니었지만, 잘쓰다가 mysql 을 업그레이드하거나 할 때 나오면 당황하게 마련이므로 알아두면 좋다.</p>\n<p>이것을 몰라서 python 으로 된 mysql-connector 를 사용하는 경우도 있는데, 문제는 없지만, 성능이 문제가 되는 어플리케이션이라면 위의 방법으로 해결하는 것이 좋다.</p>","excerpt":"<h2><code class=\"language-text\">_mysql</code> 이 없다는 에러 발생</h2>\n<p>장고에서 mysqlclient를 사용하고 있는데, 쓰다보면 아래와 같은 에러를 만나는 경우가 종종있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ImportError: dlopen(..._mysql.cpython-38-darwin.so, 2): Library not loaded: @rpath/libmysqlclient.21.dylib\n  Referenced from: .../site-packages/_mysql.cpython-38-darwin.so\n  Reason: image not found\nNameError: name &#39;_mysql&#39; is not defined</code></pre></div>\n<p>에러를 보면 <code class=\"language-text\">_mysql</code> 이 정의되지 않았다고 한다.\n또 그 녀석은 cpython-38-darwin.so 이라는 파일에 있는 것 같다. 그렇다는 얘기는 <code class=\"language-text\">cpython-38-darwin.so</code>…</p>","tableOfContents":"<ul>\n<li><a href=\"/2020/import-c-library-in-python/#code-classlanguage-text_mysqlcode-%EC%9D%B4-%EC%97%86%EB%8B%A4%EB%8A%94-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D\"><code class=\"language-text\">_mysql</code> 이 없다는 에러 발생</a></li>\n<li><a href=\"/2020/import-c-library-in-python/#%EB%AC%B8%EC%A0%9C-%EC%9E%AC%ED%98%84\">문제 재현</a></li>\n<li><a href=\"/2020/import-c-library-in-python/#%EC%9B%90%EC%9D%B8\">원인</a></li>\n<li><a href=\"/2020/import-c-library-in-python/#%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\">해결하기</a></li>\n</ul>","timeToRead":2,"frontmatter":{"title":"장고에서 C mysql 이 임포트 되지 않는 문제 해결하기","tags":["python","django","mysql"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/3dc555f92b6aefd95ba78cbcb5871da8/2244e/20201220.jpg","height":267,"width":400}}}}}},"pageContext":{"slug":"/2020/import-c-library-in-python/","next":{"fields":{"slug":"/diary/2021/01/"},"frontmatter":{"title":"2021년 1월 일기들","tags":null,"category":"diary","image":{"childImageSharp":{"resize":{"src":"/static/82ae00499895127eb2c1daccc4b4b99b/2244e/january.jpg","height":267,"width":400}}}}},"prev":{"fields":{"slug":"/diary/2020/11/2020년-11월-일기/"},"frontmatter":{"title":"2020년 11월의 일상","tags":null,"category":"diary","image":{"childImageSharp":{"resize":{"src":"/static/700fbfe4c86d2ca834e00e78cfac0f8d/2244e/november.jpg","height":600,"width":400}}}}}}},"staticQueryHashes":["3159585216","4202924991"]}