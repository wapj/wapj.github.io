{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/use-mitmproxy-as-http-proxy/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>회사에서 안드로이드 에뮬레이터 띄워서 테스트시에 요청이 올바르게 오는지 필요해서 깔아봤는데, 인증서 설치가 매우 힘들었다. 안드로이드 API 버전을 8이하로 하면 매우 쉽게 된다고 한다. 그렇지만 그 이상으로 테스트 해야되는 경우 필요할 것 같아서 남겨둔다.</p>\n</blockquote>\n<h2>준비물</h2>\n<p>안드로이드 스튜디오, 안드로이드 SDK → 안드로이드 가상 디바이스 를 만들기 위해서 필요하다.\n가상 디바이스를 만들고 난 다음 부터는 emualtor 명령어로 켜면됨.</p>\n<blockquote>\n<p>주의</p>\n</blockquote>\n<p>안드로이드 가상 디바이스를 만들때는 play store 딱지가 없는 녀석으로 해야 proxy설정이 가능하다!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9efb5afd8d9031fc9997c08acdb37c42/f213e/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZklEQVQ4y2VT22oUQRCd/zBREEUIJDHRjcnszq177pfdTXY1IiYBLygIEvMQQ1QEn332IwR/ILIYfNAnv+lYp3Znjfpw6Ooz1aeqTvc4vdDAN/EcJs0RJdlsTYWzynuRneM/zvzhHS+iSAHfpugGBlnVIK8b2CxHnBeKpChRNAP5ViuSohKeXF9z07LS2GYFHGMN6jqHtQH8wFMykeRAOghsop2EcaqF+I3gnt9UXHI5TVbWmuts5g/RGRxhtXyJ9WQPJkm0+pYXSMeRwvVDRHGqB9oi5CjS7ou6PxVcufcRq4e/sPj4J66NP8HERkaq1cdWkD63sRGe3XeDqWAoghTNZQL66NC7rNmBLRps+UYvIp1VbkUI7nkgagXZYVXP9/MO/cggFdO7fgDX82HFj7baRUH6Ro5+hXGighQhz33ZH84EZ+r0jaOxExrd+nTRR6IVZswXwHx2yKl0ZE9EWJXPhAd5i/Sm9U4hMQtSjBPw2fA7u5p2nKIebKu4w0q80RZ5PUB/dFdXm8t7kwsiGBOlHKyGI42bnTEyycvljQ7Hu0ikEefiWBQ0WSlJ4ofN5A+Q8eTSuJqsQpDkKhSlpXJFf1uKNbIvpNBIOs3/FfSRxKHAR8/twOttTNHdUC4KXVjT07XX7aAqYyR2ytdVgjBwp4KuCsrofoSN4RE643dYaV5jWXEi8THWhm+w2j/B7Z1TiU+xXB/D3X2Pzugt1ocn2Lr/AWvN0d+Cd3yLm48/49bhD1x9NMGl/QkWDya4fHCGBVkX9s6w9GyC60/PsbB/hs1X51h6/g03nnzF8ovvuPLgC34DbtMBAdsIK8cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"안드로이드가상디바이스 선택화면\"\n        title=\"안드로이드가상디바이스 선택화면\"\n        src=\"/static/9efb5afd8d9031fc9997c08acdb37c42/0a47e/1.png\"\n        srcset=\"/static/9efb5afd8d9031fc9997c08acdb37c42/8a4e8/1.png 150w,\n/static/9efb5afd8d9031fc9997c08acdb37c42/5a46d/1.png 300w,\n/static/9efb5afd8d9031fc9997c08acdb37c42/0a47e/1.png 600w,\n/static/9efb5afd8d9031fc9997c08acdb37c42/1cfc2/1.png 900w,\n/static/9efb5afd8d9031fc9997c08acdb37c42/f213e/1.png 1192w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>mitmproxy 사용해보기</h2>\n<p>​​</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 설치\nbrew install mitmproxy\n\n# 실행\nmitmproxy -p {포트}</code></pre></div>\n<h2>안드로이드 에뮬레이터에 proxy 설정하기</h2>\n<p>안드 에뮬레이터에서 설정 (번거로우니 안하는게 좋을듯)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 548px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/26dbecc9a732ff171fa763f0e0a99b81/a58fe/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6klEQVQoz6VQyYqFQAz0/z/D3xBEPXhW3EHF7YEL7oriVkMHGjzMYw4TKNKdrlSqI2iaBsMwoOs6FEWBJEmwLAtJkiCKIkIcx7+CvWVZBlVVwXREUYTQdR3+G8/zUPY8D0JRFPh8PlSoqgqmacL3fQRBgDAMYds21aZpIs593wQW67oSj93zPCeewEQ4ads29H2PcRwJwzCgbVssy4LzPMkJ57LzcRwEPsBxHAhpmkKWZWqY55l2UpYlCTVNQ8L8W28xnhmu6yKO67oQ6rqmKSz2fSeHbK+c9N7Rt+AOaYfMxbcm7uAvvAV/AAG3FZhYKAfmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"안드로이드가상디바이스 선택화면\"\n        title=\"안드로이드가상디바이스 선택화면\"\n        src=\"/static/26dbecc9a732ff171fa763f0e0a99b81/a58fe/2.png\"\n        srcset=\"/static/26dbecc9a732ff171fa763f0e0a99b81/8a4e8/2.png 150w,\n/static/26dbecc9a732ff171fa763f0e0a99b81/5a46d/2.png 300w,\n/static/26dbecc9a732ff171fa763f0e0a99b81/a58fe/2.png 548w\"\n        sizes=\"(max-width: 548px) 100vw, 548px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Network details → (연필누름) → Advanced Options → Proxy → ip와 port 설정후 저장</code></pre></div>\n<p>에뮬레이터가 실행중 일때 adb로 세팅 할 수 있음. <a href=\"https://compiler.tistory.com/29\">여기</a>참고</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">adb shell settings put global http_proxy 아이피:포트\n\n# 프록시 설정 해제\nadb shell settings put global http_proxy :0</code></pre></div>\n<h2>mitm 인증서 설치</h2>\n<p>굉장히 귀찮고 주의할 점이 많으니 차근 차근 진행하자.</p>\n<h3>1. 준비물</h3>\n<p>안드로이드 SDK의 emulator, adb 명령어를 사용할 수 있게 패스에 추가하자.</p>\n<p>나는 아래와 같이 해줬음.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export PATH=$PATH:$HOME/Library/Android/sdk/emulator:$HOME/Library/Android/sdk/platform-tools</code></pre></div>\n<p>일단 에뮬레이터 시작시 <code class=\"language-text\">-writable-system</code> 옵션을 꼭 넣어줘야 한다. 그리고 adb root 명령을 사용할 수 있어야하는데, 위에서 안드로이드 가상 디바이스를 만들때 play store 딱지가 있으면 adb root를 사용할 수 없으니 주의!</p>\n<h3>2. 인증서 이름 바꾸기</h3>\n<p>mitmproxy를 설치하면 ~/.mitmproxy 디렉토리 아래에 가짜 인증서가 들어 있다.</p>\n<p>아래 명령을 실행해서 인증서를 카피한다. 그러면 c8750f0d.0 같은 이름의 파일이 생긴다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">hashed_name=`openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.cer | head -1` &amp;&amp; cp mitmproxy-ca-cert.cer $hashed_name.0</code></pre></div>\n<h3>3. 인증서를 안드로이드 디바이스에 넣자.</h3>\n<p>순서대로 아래와 같이 실행해준다.</p>\n<ol>\n<li>AVD의 리스트를 확인하자 : emulator -list-avds (없으면 AVD 매니저에서 만들어야함)</li>\n<li>인증서를 복사할 AVD를 시작하자: emulator -avd &#x3C;avd_name> -writable-system (-show-kernel 커널로그 보기)</li>\n<li>abd를 root계정으로 재시작 : adb root</li>\n<li>보안 부팅 비활성화: adb shell avbctl disable-verification</li>\n<li>디바이스 재부팅 : adb reboot</li>\n<li>adb root 계정으로 재시작 : adb root</li>\n<li>adb리마운트 : adb remount</li>\n<li>2단계에서 만든 인증서를 카피하자: adb push &#x3C;인증서경로> /system/etc/security/cacerts</li>\n<li>인증서 권한 설정: adb shell chmod 664 /system/etc/security/cacerts/&#x3C;인증서파일명></li>\n<li>디바이스 재시작: adb reboot</li>\n</ol>\n<p>여기까지하면 mitmproxy로 로그가 남는다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c94259f1448dc7be8ccfb756d7723bae/1e093/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVQI1z3OQW7CMBBA0awipBBRtRSpN0CICmKnDvHY4zggyqL3v86vC6iLr9mM3kz15Rx+HPnUiWMYyXbL4dBx7Do6Y/CnEfFCjPFeKGl4Joo4Yb3esGhbmtULlfeepBF7ueBS4DbsMdZiCvY3eznT6w0nmRjCHVVVcsF08NhyvF0uqeuapmmoRIScEub6jZuVn2H3D1rbE8rnKZ/RNBXogaWyf/UT8ykymJ6Ptw3vq9cCt/wCmDJf4TYA6/YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"안드로이드가상디바이스 선택화면\"\n        title=\"안드로이드가상디바이스 선택화면\"\n        src=\"/static/c94259f1448dc7be8ccfb756d7723bae/0a47e/3.png\"\n        srcset=\"/static/c94259f1448dc7be8ccfb756d7723bae/8a4e8/3.png 150w,\n/static/c94259f1448dc7be8ccfb756d7723bae/5a46d/3.png 300w,\n/static/c94259f1448dc7be8ccfb756d7723bae/0a47e/3.png 600w,\n/static/c94259f1448dc7be8ccfb756d7723bae/1cfc2/3.png 900w,\n/static/c94259f1448dc7be8ccfb756d7723bae/c1b63/3.png 1200w,\n/static/c94259f1448dc7be8ccfb756d7723bae/1e093/3.png 1376w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>유용한 단축키</p>\n<p>F(대문자) : 프록시로 중간에 가로챈 요청을 자동으로 위로 올라가게 한다. 기본적으로 꺼져있어서 F룰 눌러주면 동작함</p>\n<p>스페이스 : Flow의 커서가 중간에 있을때 다음페이지로 가는 키가 여러개 있는데 스페이스를 치면 바로 다음 페이지로 이동. (기본 페이징 사이즈는 30)</p>","excerpt":"<blockquote>\n<p>회사에서 안드로이드 에뮬레이터 띄워서 테스트시에 요청이 올바르게 오는지 필요해서 깔아봤는데, 인증서 설치가 매우 힘들었다. 안드로이드 API 버전을…</p></blockquote>","tableOfContents":"<ul>\n<li><a href=\"/2022/use-mitmproxy-as-http-proxy/#%EC%A4%80%EB%B9%84%EB%AC%BC\">준비물</a></li>\n<li><a href=\"/2022/use-mitmproxy-as-http-proxy/#mitmproxy-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\">mitmproxy 사용해보기</a></li>\n<li><a href=\"/2022/use-mitmproxy-as-http-proxy/#%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EC%97%90%EB%AE%AC%EB%A0%88%EC%9D%B4%ED%84%B0%EC%97%90-proxy-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">안드로이드 에뮬레이터에 proxy 설정하기</a></li>\n<li>\n<p><a href=\"/2022/use-mitmproxy-as-http-proxy/#mitm-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%84%A4%EC%B9%98\">mitm 인증서 설치</a></p>\n<ul>\n<li><a href=\"/2022/use-mitmproxy-as-http-proxy/#1-%EC%A4%80%EB%B9%84%EB%AC%BC\">1. 준비물</a></li>\n<li><a href=\"/2022/use-mitmproxy-as-http-proxy/#2-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%9D%B4%EB%A6%84-%EB%B0%94%EA%BE%B8%EA%B8%B0\">2. 인증서 이름 바꾸기</a></li>\n<li><a href=\"/2022/use-mitmproxy-as-http-proxy/#3-%EC%9D%B8%EC%A6%9D%EC%84%9C%EB%A5%BC-%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C-%EB%94%94%EB%B0%94%EC%9D%B4%EC%8A%A4%EC%97%90-%EB%84%A3%EC%9E%90\">3. 인증서를 안드로이드 디바이스에 넣자.</a></li>\n</ul>\n</li>\n</ul>","timeToRead":2,"frontmatter":{"title":"안드로이드의 에뮬레이터의 https 프록시로 mitmproxy 를 써보자","tags":["mitmproxy","developer"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/9efb5afd8d9031fc9997c08acdb37c42/497c6/1.png","height":280,"width":400}}}}}},"pageContext":{"slug":"/2022/use-mitmproxy-as-http-proxy/","next":null,"prev":{"fields":{"slug":"/2022/surviving-as-a-developer/"},"frontmatter":{"title":"[책읽기] 개발자로 살아남기","tags":["BOOKS","developer"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/f525548589306a5efd2d1756fe2bff2d/2244e/survive.jpg","height":267,"width":400}}}}}}},"staticQueryHashes":["3159585216","4202924991"]}