{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/get_alert_end_of_server_boot/","result":{"data":{"markdownRemark":{"html":"<h2>개요</h2>\n<p>스프링 서버는 보통 기동시 30초 이상 걸리는 경우가 굉장히 많다. 그래서 서버를 재시작 할때마다 30초씩 넋을 놓고 기다리는 경우가 많이 있는데, 기다리지 않고 스크립트로 감시를 걸어둔 다음 알림으로 받을 수 있으면 좋을 것 같다. 하나씩 해보도록 하자.</p>\n<h3>기동시 확인할 API</h3>\n<p>스프링 부트 서버가 기동 되었는지 확인하는 API는 다음과 같다고 가정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;서버URL>test/info</code></pre></div>\n<p>스프링이라면 요런 식으로 만들 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ApiTestController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">BuildProperties</span> buildProperties<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/info\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">extInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span>buildProperties<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token char\">' '</span> <span class=\"token operator\">+</span> buildProperties<span class=\"token punctuation\">.</span><span class=\"token function\">getVersion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> buildProperties<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token char\">' '</span> <span class=\"token operator\">+</span> buildProperties<span class=\"token punctuation\">.</span><span class=\"token function\">getVersion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>호출시 아래와 같은 정보를 문자열로 반환해 준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">api version : {버전정보}</code></pre></div>\n<p>성공하면 api version 이 찍히는 것을 알았으니 특정 문자열이 터미널에 찍히는 것으로 알림을 받을 수 있다. iterm2에서는 트리거라는 기능으로 해당 기능을 제공하고 있다.</p>\n<h2>서버를 계속 호출하는 쉘 스크립트 만들기</h2>\n<p>특정 문자열이 들어오는지를 체크 후 iterm2 트리거로 등록 하여 알림을 받을 수 있다.\n마찬가지로 다른 서버에서도 비슷한 API를 만들어서 똑같이 알림을 받을 수 있도록 처리할 수 있을 것이다.</p>\n<p>아래와 같은 쉘 스크립트를 만들어보자.\nwhile true가 있어서 3초마다 한번씩 무한으로 계속 실행된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n\n <span class=\"token assign-left variable\">SERVER</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${1<span class=\"token operator\">:-</span>api}</span>\"</span>\n <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$SERVER</span>\"</span>\n <span class=\"token assign-left variable\">SERVER_URL</span><span class=\"token operator\">=</span><span class=\"token string\">\"http://localhost:9090/test/info\"</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span>\n    <span class=\"token assign-left variable\">STATUS</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">curl</span> -s -o /dev/null -I -w <span class=\"token string\">\"%{http_code}\"</span>  $SERVER_URL<span class=\"token variable\">`</span></span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$STATUS</span>\"</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"200\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"서버 기동 성공!\"</span>\n        <span class=\"token builtin class-name\">break</span>\n    <span class=\"token keyword\">fi</span>\n\n    <span class=\"token function\">sleep</span> <span class=\"token number\">3</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<p>여기서 성공시 서버 기동 성공!  을 줄 것이다.\n특정 문자열을 iterm2의 트리거로 등록하여 알림을 받아보자.</p>\n<h2>iterm2에 트리거로 등록하기</h2>\n<p>iterm2에는 아래와 같이 설정한다.</p>\n<p>Profiles → Advanced → Triggers → Edit → Triggers → + 버튼 눌러 추가</p>\n<p>→ Regular Expression : 서버 기동 성공.* , Action : Post Notification, Parameters : 노티시의 메세지, Instant : 체크, Enabled : 체크</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/23041eeb11df66e5e39225b89db75276/3a1b1/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQY002Q22rDMBBE/f+/0kKeWyjksa3BF2hISSCxI99kWbYsW76l8VRS2tKHg4Zld3ZHzshLVIyCUU1ZIact6oqBM4ayKNA2jX2LLNN9DKNSlus8YxoGi9HLNFkc1SsIPSTqGpw3oKy1JqbWcH5f9APNc1RlqRdWaHS/0WaxFAKtppcSTqeFkgK3ZQTWBbjNmsWi+h6+H+B4OCBNCFJCEEcRSBwjOp2sjs/ne+1ysUkcQjs8+QIbV+LRVZoeD+89Nt4AmjEct8/Yb18QvrkIgwCB52G/21nTLEksiTYzmBRO2w1g3Yq0/gLh1z8SsULqhtZ/RR16iD8+kaaJvfJ32MT9j/mCb43fc5KKddmTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"iterm2설정 1\"\n        title=\"iterm2설정 1\"\n        src=\"/static/23041eeb11df66e5e39225b89db75276/0a47e/2.png\"\n        srcset=\"/static/23041eeb11df66e5e39225b89db75276/8a4e8/2.png 150w,\n/static/23041eeb11df66e5e39225b89db75276/5a46d/2.png 300w,\n/static/23041eeb11df66e5e39225b89db75276/0a47e/2.png 600w,\n/static/23041eeb11df66e5e39225b89db75276/1cfc2/2.png 900w,\n/static/23041eeb11df66e5e39225b89db75276/c1b63/2.png 1200w,\n/static/23041eeb11df66e5e39225b89db75276/3a1b1/2.png 1686w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/191d908197e9695aee051258f5eab26d/d7ceb/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAkElEQVQI102P6woEIQiF5/2fsh8TBDtMRU1WVme1ZWEEUbx8Rw/vPYwxKKWAmdF7xxgDf1tr7V5rbedvV+Pe0GoFUdl7BxHBWgvnHJrAUkr4XBdUqMqggs7zRAhhQ3RpzilxitqEvQnOF9grYw7GoRflnPHIFZqTQGKMG5ifB1WAGrWugirw9lgYmRiJft99Abzd6TLg9fnZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"iterm2설정 2\"\n        title=\"iterm2설정 2\"\n        src=\"/static/191d908197e9695aee051258f5eab26d/0a47e/3.png\"\n        srcset=\"/static/191d908197e9695aee051258f5eab26d/8a4e8/3.png 150w,\n/static/191d908197e9695aee051258f5eab26d/5a46d/3.png 300w,\n/static/191d908197e9695aee051258f5eab26d/0a47e/3.png 600w,\n/static/191d908197e9695aee051258f5eab26d/1cfc2/3.png 900w,\n/static/191d908197e9695aee051258f5eab26d/c1b63/3.png 1200w,\n/static/191d908197e9695aee051258f5eab26d/d7ceb/3.png 1446w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>만들어둔 스크립트를 서버가 뜨는동안 실행 해두면 서버가 완전히 뜰때까지 감시를 하고 끝나면 알람을 주고 스트립트가 종료된다.</p>\n<p>이제 서버 뜨는동안 잠깐 딴짓을 할 수 있다!</p>","excerpt":"<h2>개요</h2>\n<p>스프링 서버는 보통 기동시 30초 이상 걸리는 경우가 굉장히 많다. 그래서 서버를 재시작 할때마다 3…</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/2022/get_alert_end_of_server_boot/#%EA%B0%9C%EC%9A%94\">개요</a></p>\n<ul>\n<li><a href=\"/2022/get_alert_end_of_server_boot/#%EA%B8%B0%EB%8F%99%EC%8B%9C-%ED%99%95%EC%9D%B8%ED%95%A0-api\">기동시 확인할 API</a></li>\n</ul>\n</li>\n<li><a href=\"/2022/get_alert_end_of_server_boot/#%EC%84%9C%EB%B2%84%EB%A5%BC-%EA%B3%84%EC%86%8D-%ED%98%B8%EC%B6%9C%ED%95%98%EB%8A%94-%EC%89%98-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0\">서버를 계속 호출하는 쉘 스크립트 만들기</a></li>\n<li><a href=\"/2022/get_alert_end_of_server_boot/#iterm2%EC%97%90-%ED%8A%B8%EB%A6%AC%EA%B1%B0%EB%A1%9C-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0\">iterm2에 트리거로 등록하기</a></li>\n</ul>","timeToRead":2,"frontmatter":{"title":"스프링 서버가 뜨는 동안 기다리지 말고, 알림으로 받자.","tags":["iterm2","spring","java"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/6d99eac9285f72fecf87d20b2c519a85/2244e/1.jpg","height":267,"width":400}}}}}},"pageContext":{"slug":"/2022/get_alert_end_of_server_boot/","next":{"fields":{"slug":"/2022/tinnitus/"},"frontmatter":{"title":"이명이 생기다","tags":["life","tinnitus"],"category":"diary","image":null}},"prev":{"fields":{"slug":"/2022/use-mitmproxy-as-http-proxy/"},"frontmatter":{"title":"안드로이드의 에뮬레이터의 https 프록시로 mitmproxy 를 써보자","tags":["mitmproxy","developer"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/9efb5afd8d9031fc9997c08acdb37c42/497c6/1.png","height":280,"width":400}}}}}}},"staticQueryHashes":["3159585216","4202924991"]}