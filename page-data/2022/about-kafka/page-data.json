{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/about-kafka/","result":{"data":{"markdownRemark":{"html":"<h2>카프카란?</h2>\n<ul>\n<li>대용량, 대규모 메시지 데이터를 빠르게 처리하도록 개발된 메시징 플랫폼. </li>\n<li>홈페이지에는 고성능 데이터 파이프라인, 스트리밍 분석, 데이터 통합, 미션 크리티컬한 애플리케이션을 위한 분산 이벤트 스트리밍 플랫폼으로 소개하고 있음. </li>\n<li>기술에 보수적인 제조사, 통신사, 은행, 보험사 중 가장 큰 곳들은 대부분 사용한다고 함. </li>\n</ul>\n<p>자세한 것은 <a href=\"https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying\">The Log</a>라는 글을 읽어보면 좋다. </p>\n<h2>카프카 설치 </h2>\n<ul>\n<li><a href=\"https://kafka.apache.org/downloads\">https://kafka.apache.org/downloads</a> 에서 바이너리 버전을 받아서 압축 풀기. $HOME 디렉토리에 압축을 풀었다고 가정함   </li>\n<li>나는 대충 최신 버전을 받았음 어차피 바이너리라...</li>\n<li>직접다운로드 링크는 여기 <a href=\"https://dlcdn.apache.org/kafka/3.1.1/kafka_2.13-3.1.1.tgz\"><strong>https://dlcdn.apache.org/kafka/3.1.1/kafka_2.13-3.1.1.tgz</strong></a></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ffdfa682eef2b7bde62b21e0c476fcfd/eff3b/kafka1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVQoz5VSSW7DMBDT///kkwG/oJfUaZ0E8L7L+8pyhNZAD3FTAYSk0QzNGVq5rgvLsuA4DmzbRhiGOFv7vp++q2EYkKapIYrj2MD3fYRRhKKqMIwjJGdaloPsjFSVZYmKhW3bQmttzhVjddOg6nto7jVjmuftFcKGBYJpmrDMM/7oF+cNk1BT2dv1io/HA7m0SNKe5C1bXdb1UPQqVNd1CILAoOWsRs5qIGFHzN+E/1lKWJMkMeoizjCj4riuEfD+Q7ht22+wZnumUBx8v1zg3W5wPQ8eW/+83w083vM8N2aJeTU/pAkxTVAUxQF5XylAibsmyEKBEJhk7lmWGddlLGKc5Aoa+ZWeGPgFwEy62hqE9FMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"kafka1\"\n        title=\"kafka1\"\n        src=\"/static/ffdfa682eef2b7bde62b21e0c476fcfd/0a47e/kafka1.png\"\n        srcset=\"/static/ffdfa682eef2b7bde62b21e0c476fcfd/8a4e8/kafka1.png 150w,\n/static/ffdfa682eef2b7bde62b21e0c476fcfd/5a46d/kafka1.png 300w,\n/static/ffdfa682eef2b7bde62b21e0c476fcfd/0a47e/kafka1.png 600w,\n/static/ffdfa682eef2b7bde62b21e0c476fcfd/1cfc2/kafka1.png 900w,\n/static/ffdfa682eef2b7bde62b21e0c476fcfd/c1b63/kafka1.png 1200w,\n/static/ffdfa682eef2b7bde62b21e0c476fcfd/eff3b/kafka1.png 2072w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>  </p>\n<h3>주키퍼 시작하기 </h3>\n<p>카프카는 주키퍼에 의존성이 있음. 그러므로 주키퍼를 먼저 시작시켜줘야함.</p>\n<p>다음 스크립트로 실행. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">~/kafka_2.13-3.1.1/bin/zookeeper-server-start.sh ~/kafka_2.13-3.1.1/config/zookeeper.properties</code></pre></div>\n<p>데몬모드</p>\n<blockquote>\n<p>-daemon 플래그를 붙이면 주키퍼를 데몬모드로 올릴 수 있음. (백그라운드에서 돈다는 뜻)</p>\n</blockquote>\n<p>잘은 모르겠지만, 뭔가 많은 로그가 올라가면서 주키퍼가 기동됨 </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[2022-05-14 23:36:17,913] INFO   ______                  _                                           (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,913] INFO  |___  /                 | |                                          (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,913] INFO     / /    ___     ___   | | __   ___    ___   _ __     ___   _ __    (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,914] INFO    / /    / _ \\   / _ \\  | |/ /  / _ \\  / _ \\ | '_ \\   / _ \\ | '__| (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,914] INFO   / /__  | (_) | | (_) | |   &lt;  |  __/ |  __/ | |_) | |  __/ | |     (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,914] INFO  /_____|  \\___/   \\___/  |_|\\_\\  \\___|  \\___| | .__/   \\___| |_| (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,914] INFO                                               | |                      (org.apache.zookeeper.server.ZooKeeperServer)\n[2022-05-14 23:36:17,914] INFO                                               |_|                      (org.apache.zookeeper.server.ZooKeeperServer)</code></pre></div>\n<h2>아파치 카프카 시작하기 </h2>\n<p>다른 터미널 창에서 다음과 같이 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">~/kafka_2.13-3.1.1/bin/kafka-server-start.sh ~/kafka_2.13-3.1.1/config/server.properties</code></pre></div>\n<p>뭔가 많이 뜨면서 에러가 안나면 성공. 포트는 9092 인듯 </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[2022-05-14 23:39:24,954] INFO [ThrottledChannelReaper-Fetch]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)\n[2022-05-14 23:39:24,956] INFO [ThrottledChannelReaper-Produce]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)\n[2022-05-14 23:39:24,956] INFO [ThrottledChannelReaper-Request]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)\n[2022-05-14 23:39:24,958] INFO [ThrottledChannelReaper-ControllerMutation]: Starting (kafka.server.ClientQuotaManager$ThrottledChannelReaper)\n[2022-05-14 23:39:24,974] INFO Log directory /tmp/kafka-logs not found, creating it. (kafka.log.LogManager)\n[2022-05-14 23:39:25,005] INFO Loading logs from log dirs ArraySeq(/tmp/kafka-logs) (kafka.log.LogManager)\n[2022-05-14 23:39:25,010] INFO Attempting recovery for all logs in /tmp/kafka-logs since no clean shutdown file was found (kafka.log.LogManager)\n[2022-05-14 23:39:25,017] INFO Loaded 0 logs in 11ms. (kafka.log.LogManager)\n[2022-05-14 23:39:25,018] INFO Starting log cleanup with a period of 300000 ms. (kafka.log.LogManager)\n[2022-05-14 23:39:25,020] INFO Starting log flusher with a default period of 9223372036854775807 ms. (kafka.log.LogManager)\n[2022-05-14 23:39:25,315] INFO [BrokerToControllerChannelManager broker=0 name=forwarding]: Starting (kafka.server.BrokerToControllerRequestThread)\n[2022-05-14 23:39:25,480] INFO Updated connection-accept-rate max connection creation rate to 2147483647 (kafka.network.ConnectionQuotas)\n[2022-05-14 23:39:25,484] INFO Awaiting socket connections on 0.0.0.0:9092. (kafka.network.Acceptor)</code></pre></div>\n<h3>$PATH에 환경변수 설정하기 </h3>\n<p><code class=\"language-text\">kafka_2.13-3.1.1/bin</code>  은 자주 사용하게 될 것이니, 귀찮으면 PATH에 등록해도 됨.   </p>\n<p>.zshrc 나 .bash_profile등에 다음과 같이 하면됨. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PATH=\"$PATH:~/kafka_2.13-3.1.1/bin\"</code></pre></div>\n<h3>카프카와 주키퍼의 데이터 저장 디렉터리 변경하기 (옵션)</h3>\n<p>주키퍼의 경우 : <code class=\"language-text\">zookeeper.properties</code>  의 dataDir 값을 변경하면 원하는 곳으로 데이터 저장 디렉터리를 변경할 수 있다. </p>\n<p>카프카의 경우 : <code class=\"language-text\">server.properties</code>   의 log.dirs 를 원하는 디렉터리로 변경하기</p>\n<h3>심볼릭 링크만들기 (옵션)</h3>\n<p>kafka_2.13-3.1.1 이렇게 매번 타이핑하기 귀찮으니 <code class=\"language-text\">kafka</code>  로 심볼릭 링크를 만들자. </p>\n<p>이렇게 하면  조금 편하게 카프카 디렉터리로 접근할 수 있다. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ln -s kafka_2.13-3.1.1 kafka</code></pre></div>\n<h2>토픽 만들고 삭제하기 </h2>\n<p>만들기</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./kafka/bin/kafka-topics.sh --create --topic andy-test-topic --bootstrap-server loc\nalhost:9092 --replication-factor 1 --partitions 1</code></pre></div>\n<p>삭제하기</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./kafka/bin/kafka-topics.sh --\bdelete --topic andy-test-topic --bootstrap-server loc\nalhost:9092</code></pre></div>\n<blockquote>\n<p>카프카 2.x.x를 사용하는 경우 --boostrap-server 대신 --zookeeper localhost:2181 을 사용해야함</p>\n</blockquote>\n<h2>토픽 조회하기 </h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./kafka-topics.sh --list --bootstrap-server localhost:9092\nandy-test-topic</code></pre></div>\n<p>--describe 를 사용하면 상세정보 나옴</p>\n<h2>토픽에 메시지 보내기</h2>\n<p>키를 지정하지 않고 메세지 보내기 </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./kafka-console-producer.sh --broker-list localhost:9092 --topic andy-tes\nt-topic</code></pre></div>\n<p>이것 저것 입력후 Ctrl + C 로 빠져나오기 </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> 안녕하시요.\n>hello kafka\n>nice to meet you</code></pre></div>\n<p>키를 지정하려면 다음과 같이 해야함 </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./kafka-console-producer.sh \\\n  --broker-list localhost:9092 \\\n  --topic \bandy-test-topic \\\n  --property \"parse.key=true\" \\\n  --property \"key.separator=:\"</code></pre></div>\n<h2>컨슈머로 읽기</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic and\ny-test-topic --from-beginning</code></pre></div>\n<p>결과값</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">안녕하시요.\nhello kafka\nnice to meet you</code></pre></div>\n<h2>카프카 테스트 프로젝트 </h2>\n<h3>gradle 설정</h3>\n<p><strong>confluent 저장소 추가 하기</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">repositories {\n    mavenCentral()\n    maven {\n        url \"https://packages.confluent.io/maven\"\n    }\n}</code></pre></div>\n<p>카프카 클라이언트 의존성 추가  (스트림즈도 공부할거라 스트림즈도 넣어줌)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">implementation 'org.codehaus.groovy:groovy-all:3.0.5'\ntestImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.2'\ntestRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.2'\nimplementation 'org.apache.kafka:kafka-clients:3.1.1'\nimplementation 'org.apache.kafka:kafka-streams:3.1.1'\nimplementation 'org.slf4j:slf4j-api:1.7.36'\nimplementation 'org.slf4j:slf4j-simple:1.7.32'</code></pre></div>\n<p>Helloworld 클래스 만들기 </p>\n<p>me.gyus.demos.kafka 패키지로 만들자. </p>\n<h3>프로듀서 테스트</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">package me.gyus.demos.kafka;\n\n\nimport org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerConfig;\nimport org.apache.kafka.clients.producer.ProducerRecord;\nimport org.apache.kafka.common.serialization.StringSerializer;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport java.util.Properties;\n\npublic class ProducerDemo {\n    private static final Logger log = LoggerFactory.getLogger(ProducerDemo.class);\n\n    public static void main(String [] args) {\n        log.info(\"I am a kafka Producer\");\n        String bootstrapServers = \"127.0.0.1:9092\";\n\n        Properties properties = new Properties();\n        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n\n        // create the producer\n        KafkaProducer&lt;String, String> producer = new KafkaProducer&lt;>(properties);\n        for (int i=0;i&lt;10; i++) {\n            String topic = \"demo_java\";\n            String value = \"hello world \" + i;\n            String key = \"id_\" + i;\n            ProducerRecord&lt;String, String> producerRecord = new ProducerRecord&lt;>(topic, key, value);\n            producer.send(producerRecord, (metadata, e) -> {\n                if (e == null) {\n                    log.info(\"Received new metadata. \\n\" +\n                            \"Topic:\" + metadata.topic() + \"\\n\" +\n                            \"Key:\" + producerRecord.key() + \"\\n\" +\n                            \"Partition: \" + metadata.partition() + \"\\n\" +\n                            \"Offset: \" + metadata.offset() + \"\\n\" +\n                            \"Timestamp: \" + metadata.timestamp());\n                } else {\n                    log.error(\"Error while producing\", e);\n                }\n            });\n\n            try{\n                Thread.sleep(1000);\n            } catch(InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        producer.flush();\n        producer.close();\n\n    }\n}</code></pre></div>\n<h2>참고 </h2>\n<p><a href=\"https://www.sohamkamani.com/install-and-run-kafka-locally/\">https://www.sohamkamani.com/install-and-run-kafka-locally/</a></p>","excerpt":"<h2>카프카란?</h2>\n<ul>\n<li>대용량, 대규모 메시지 데이터를 빠르게 처리하도록 개발된 메시징 플랫폼. </li>\n<li>…</li></ul>","tableOfContents":"<ul>\n<li><a href=\"/2022/about-kafka/#%EC%B9%B4%ED%94%84%EC%B9%B4%EB%9E%80\">카프카란?</a></li>\n<li>\n<p><a href=\"/2022/about-kafka/#%EC%B9%B4%ED%94%84%EC%B9%B4-%EC%84%A4%EC%B9%98\">카프카 설치 </a></p>\n<ul>\n<li><a href=\"/2022/about-kafka/#%EC%A3%BC%ED%82%A4%ED%8D%BC-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\">주키퍼 시작하기 </a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/2022/about-kafka/#%EC%95%84%ED%8C%8C%EC%B9%98-%EC%B9%B4%ED%94%84%EC%B9%B4-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\">아파치 카프카 시작하기 </a></p>\n<ul>\n<li><a href=\"/2022/about-kafka/#path%EC%97%90-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">$PATH에 환경변수 설정하기 </a></li>\n<li><a href=\"/2022/about-kafka/#%EC%B9%B4%ED%94%84%EC%B9%B4%EC%99%80-%EC%A3%BC%ED%82%A4%ED%8D%BC%EC%9D%98-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%80%EC%9E%A5-%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC-%EB%B3%80%EA%B2%BD%ED%95%98%EA%B8%B0-%EC%98%B5%EC%85%98\">카프카와 주키퍼의 데이터 저장 디렉터리 변경하기 (옵션)</a></li>\n<li><a href=\"/2022/about-kafka/#%EC%8B%AC%EB%B3%BC%EB%A6%AD-%EB%A7%81%ED%81%AC%EB%A7%8C%EB%93%A4%EA%B8%B0-%EC%98%B5%EC%85%98\">심볼릭 링크만들기 (옵션)</a></li>\n</ul>\n</li>\n<li><a href=\"/2022/about-kafka/#%ED%86%A0%ED%94%BD-%EB%A7%8C%EB%93%A4%EA%B3%A0-%EC%82%AD%EC%A0%9C%ED%95%98%EA%B8%B0\">토픽 만들고 삭제하기 </a></li>\n<li><a href=\"/2022/about-kafka/#%ED%86%A0%ED%94%BD-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B8%B0\">토픽 조회하기 </a></li>\n<li><a href=\"/2022/about-kafka/#%ED%86%A0%ED%94%BD%EC%97%90-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%B3%B4%EB%82%B4%EA%B8%B0\">토픽에 메시지 보내기</a></li>\n<li><a href=\"/2022/about-kafka/#%EC%BB%A8%EC%8A%88%EB%A8%B8%EB%A1%9C-%EC%9D%BD%EA%B8%B0\">컨슈머로 읽기</a></li>\n<li>\n<p><a href=\"/2022/about-kafka/#%EC%B9%B4%ED%94%84%EC%B9%B4-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8\">카프카 테스트 프로젝트 </a></p>\n<ul>\n<li><a href=\"/2022/about-kafka/#gradle-%EC%84%A4%EC%A0%95\">gradle 설정</a></li>\n<li><a href=\"/2022/about-kafka/#%ED%94%84%EB%A1%9C%EB%93%80%EC%84%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\">프로듀서 테스트</a></li>\n</ul>\n</li>\n<li><a href=\"/2022/about-kafka/#%EC%B0%B8%EA%B3%A0\">참고 </a></li>\n</ul>","timeToRead":6,"frontmatter":{"title":"카프카에 대해서 알아보자","tags":["kafka"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/ffdfa682eef2b7bde62b21e0c476fcfd/497c6/kafka1.png","height":189,"width":400}}}}}},"pageContext":{"slug":"/2022/about-kafka/","next":null,"prev":{"fields":{"slug":"/2022/about-nestjs/"},"frontmatter":{"title":"NestJS에 대해서 알아보자","tags":["NestJS"],"category":"dev","image":{"childImageSharp":{"resize":{"src":"/static/0265417ac7d87ac1eb710d355b469fa2/497c6/nestjs_cat.png","height":171,"width":400}}}}}}},"staticQueryHashes":["3159585216","4202924991"]}